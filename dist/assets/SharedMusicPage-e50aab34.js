import{a as F,r as n,G as P,o as R,c as i,b as e,t as r,q as _,h as S,u as y,m as j,F as q,g as G,s as L,f as H,y as J,l,_ as K}from"./index-f73cffae.js";import{c as O,S as Q,P as W}from"./cloudStorage-23fd1b7b.js";import{c as M}from"./createLucideIcon-8fa92933.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=M("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=M("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),ee={class:"shared-music-page"},se={key:0,class:"loading-container"},te={key:1,class:"error-container"},oe={key:2,class:"music-player"},ae={class:"top-info"},le={class:"share-badge"},ne={class:"share-actions"},re={class:"main-content"},ie={class:"content-area"},ce={class:"music-cover"},ue=["src","alt"],de={class:"lyrics-container"},ve={class:"lyrics-content"},pe={class:"music-info"},me={class:"music-title"},ye={class:"music-artist"},he={class:"share-info"},ge={class:"progress-section"},_e={class:"time-info"},fe={class:"current-time"},ke={class:"total-time"},we={class:"player-controls"},be=["src"],Ce=F({__name:"SharedMusicPage",setup(xe){const z=J(),h=n(!0),u=n(null),o=n(null),a=n(null),v=n(!1),p=n(0),m=n(0),g=n(!1),d=n(!1),f=P(()=>m.value>0?p.value/m.value*100:0),B=P(()=>{var t;return(t=o.value)!=null&&t.lyrics?o.value.lyrics.split(`
`).map(s=>s.trim()).filter(s=>s.length>0):["暂无歌词"]});R(()=>{k()});const k=async()=>{try{h.value=!0,u.value=null;const t=z.params.shareId;if(!t)throw new Error("分享链接无效");const s=await O.getSharedMusic(t);if(!s)throw new Error("音乐不存在或已过期");o.value=s,s.title&&(document.title=`${s.title} - ${s.artist} | LoneIn`)}catch(t){u.value=t.message||"加载失败",console.error("加载分享音乐失败:",t)}finally{h.value=!1}},E=()=>{a.value&&(v.value?a.value.pause():a.value.play().catch(t=>{console.error("播放失败:",t),u.value="音频播放失败，请检查网络连接"}),v.value=!v.value)},w=()=>{g.value=!g.value},I=async()=>{try{const t=window.location.href;await navigator.clipboard.writeText(t),d.value=!0,setTimeout(()=>{d.value=!1},2e3)}catch(t){console.error("复制链接失败:",t);const s=document.createElement("textarea");s.value=window.location.href,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),d.value=!0,setTimeout(()=>{d.value=!1},2e3)}},D=t=>{if(!a.value)return;const c=t.currentTarget.getBoundingClientRect(),T=(t.clientX-c.left)/c.width*m.value;a.value.currentTime=T,p.value=T},$=()=>{a.value&&(p.value=a.value.currentTime)},A=()=>{a.value&&(m.value=a.value.duration)},N=()=>{v.value=!1,p.value=0},U=t=>{console.error("音频加载错误:",t),u.value="音频加载失败，请检查网络连接"},V=()=>{window.location.href="/"},b=t=>{const s=Math.floor(t/60),c=Math.floor(t%60);return`${s}:${c.toString().padStart(2,"0")}`},X=t=>new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"});return(t,s)=>{var c;return l(),i("div",ee,[h.value?(l(),i("div",se,[...s[0]||(s[0]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"加载音乐中...",-1)])])):u.value?(l(),i("div",te,[s[1]||(s[1]=e("div",{class:"error-icon"},"🎵",-1)),s[2]||(s[2]=e("h2",null,"音乐不存在或已失效",-1)),e("p",null,r(u.value),1),e("button",{class:"retry-btn",onClick:k},"重试")])):o.value?(l(),i("div",oe,[e("div",{class:"background-cover",style:_({backgroundImage:`url(${o.value.imageUrl})`})},[...s[3]||(s[3]=[e("div",{class:"background-overlay"},null,-1)])],4),e("div",ae,[e("div",le,[S(y(Q),{size:16,color:"white"}),s[4]||(s[4]=e("span",null,"分享的音乐",-1))]),e("div",ne,[e("button",{class:j(["action-btn",{copied:d.value}]),onClick:I},[S(y(Y),{size:16}),e("span",null,r(d.value?"已复制":"复制链接"),1)],2)])]),e("div",re,[e("div",ie,[g.value?(l(),i("div",{key:1,class:"lyrics-section",onClick:w},[e("div",de,[s[6]||(s[6]=e("h3",null,"歌词",-1)),e("div",ve,[(l(!0),i(q,null,G(B.value,(C,x)=>(l(),i("p",{key:x,class:"lyrics-line"},r(C),1))),128))]),s[7]||(s[7]=e("p",{class:"lyrics-tip"},"点击返回封面",-1))])])):(l(),i("div",{key:0,class:"cover-section",onClick:w},[e("div",ce,[e("img",{src:o.value.imageUrl,alt:o.value.title},null,8,ue),s[5]||(s[5]=e("div",{class:"cover-overlay"},[e("p",null,"点击查看歌词")],-1))])]))]),e("div",pe,[e("h1",me,r(o.value.title),1),e("p",ye,r(o.value.artist),1),e("p",he,r(X(o.value.createdAt))+" 由 "+r(o.value.sharedBy)+" 分享",1)]),e("div",ge,[e("div",_e,[e("span",fe,r(b(p.value)),1),e("span",ke,r(b(m.value)),1)]),e("div",{class:"progress-bar",onClick:D},[s[8]||(s[8]=e("div",{class:"progress-track"},null,-1)),e("div",{class:"progress-fill",style:_({width:f.value+"%"})},null,4),e("div",{class:"progress-thumb",style:_({left:f.value+"%"})},null,4)])]),e("div",we,[e("button",{class:"control-btn play-btn",onClick:E},[v.value?(l(),L(y(Z),{key:1,size:32,color:"white"})):(l(),L(y(W),{key:0,size:32,color:"white"}))])]),e("div",{class:"app-promotion"},[s[9]||(s[9]=e("div",{class:"app-info"},[e("div",{class:"app-icon"},"🎵"),e("div",{class:"app-text"},[e("h4",null,"LoneIn"),e("p",null,"创作属于你的音乐作品")])],-1)),e("button",{class:"download-app-btn",onClick:V}," 体验应用 ")])])])):H("",!0),e("audio",{ref_key:"audioPlayer",ref:a,src:(c=o.value)==null?void 0:c.audioUrl,onTimeupdate:$,onLoadedmetadata:A,onEnded:N,onError:U},null,40,be)])}}});const Le=K(Ce,[["__scopeId","data-v-dbdb19de"]]);export{Le as default};
