import{d as E,r as i,a as F,o as K,c as l,b as e,e as M,f as h,F as D,g as x,t as b,w as y,h as S,u as T,i as $,v as A,j as G,k as H,n as C,l as r,m as U,_ as q}from"./index-f73cffae.js";import{T as J}from"./TabBar-2bde1b6e.js";import{g as Q}from"./api-d1d50a56.js";import{c as I}from"./createLucideIcon-8fa92933.js";import"./user-6c86de88.js";import"./message-circle-400a59da.js";import"./musicApi-3bd1a4e5.js";const X="/assets/logo-1dceb1f3.png";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=I("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=I("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ee=E("chat",()=>{const d=i(null),m=i([]),_=i(!1),g=i([]),c=()=>{const u={id:Date.now().toString(),user_id:"current-user",created_at:new Date().toISOString(),status:"active"};return d.value=u,u};return{currentSession:d,messages:m,isTyping:_,works:g,createSession:c,sendMessage:u=>{d.value||c();const v={id:Date.now().toString(),session_id:d.value.id,role:"user",content:u,created_at:new Date().toISOString()};return m.value.push(v),v},receiveMessage:u=>{if(!d.value)return{};const v={id:(Date.now()+1).toString(),session_id:d.value.id,role:"ai",content:u,created_at:new Date().toISOString()};return m.value.push(v),v},saveWork:u=>{g.value.push(u)},clearChat:()=>{m.value=[],d.value=null}}}),te={class:"chat-page"},se={class:"video-container"},oe=["src"],ae={key:0,class:"welcome-message"},ne={class:"message-time"},ie={key:1,class:"suggestion-bubble"},le={class:"suggestion-content"},re={class:"suggestion-actions"},ce={key:2,class:"generating-message"},ue={key:3,class:"work-card-container"},de={class:"work-header"},ve={class:"work-title"},ge={class:"work-tags"},me={class:"work-content"},_e={key:0,class:"poem-content"},pe={key:1,class:"image-content"},he={class:"work-actions"},be={class:"input-area safe-area-bottom"},ke={class:"input-container"},fe=["disabled"],we=F({__name:"ChatPage",setup(d){const m=H();ee();const _=i(),g=i(),c=i(""),a=i([]),p=i(!1),k=i(!1),s=i(null),u=i("/background.mp4"),v=async()=>{if(!c.value.trim())return;const o={id:Date.now().toString(),session_id:"current",role:"user",content:c.value,created_at:new Date().toISOString()};a.value.push(o),c.value,c.value="",await C(),w(),setTimeout(()=>{const t={id:(Date.now()+1).toString(),session_id:"current",role:"ai",content:O(),created_at:new Date().toISOString()};a.value.push(t),W()&&setTimeout(()=>{p.value=!0},1e3),C(()=>w())},1e3)},O=o=>{const t=["我能感受到你的情绪，能再详细说说这件事对你的意义吗？","这听起来很有画面感，你当时的感受是怎样的？","我理解你的感受，这种经历一定很特别吧？","听起来这对你来说很重要，想要把这份心情记录下来吗？"];return t[Math.floor(Math.random()*t.length)]},W=()=>a.value.length>=6&&Math.random()>.5,f=async o=>{p.value=!1,k.value=!0;try{if(o==="poem"){const t=await Q(a.value.map(n=>n.content).join(`
`),"深思","人生感悟");s.value={id:Date.now().toString(),user_id:"current-user",session_id:"current",source_message_id:a.value[a.value.length-1].id,modality:o,title:t.title,desc:t.content,emotion_labels:["深思","感悟","诗意"],visibility:"private",created_at:new Date().toISOString()}}else await new Promise(t=>setTimeout(t,2e3)),s.value={id:Date.now().toString(),user_id:"current-user",session_id:"current",source_message_id:a.value[a.value.length-1].id,modality:o,title:"月下独酌",desc:"一幅描绘月下独自思考的画作",emotion_labels:["孤独","思念","深夜"],visibility:"private",created_at:new Date().toISOString()}}catch(t){console.error("生成内容失败:",t),s.value={id:Date.now().toString(),user_id:"current-user",session_id:"current",source_message_id:a.value[a.value.length-1].id,modality:o,title:"生成失败",desc:"抱歉，内容生成失败，请重试",emotion_labels:["系统"],visibility:"private",created_at:new Date().toISOString()}}finally{k.value=!1,C(()=>w())}},N=()=>{p.value=!1},V=()=>{console.log("语音功能待实现")},z=()=>{m.push("/conversation")},B=()=>{s.value&&console.log("查看作品:",s.value)},L=()=>{s.value&&console.log("保存作品")},P=()=>{s.value&&console.log("分享作品")},R=()=>{if(s.value){const o=s.value.modality==="poem"?"image":"poem";f(o)}},j=o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),w=()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)};return K(()=>{console.log("聊天页面已加载"),g.value&&g.value.addEventListener("loadeddata",()=>{var o;console.log("视频加载完成"),(o=g.value)==null||o.play().catch(t=>{console.log("视频自动播放失败:",t)})})}),(o,t)=>(r(),l("div",te,[e("div",se,[e("video",{class:"video-background",autoplay:"",muted:"",loop:"",playsinline:"",preload:"auto",ref_key:"videoRef",ref:g,src:u.value},null,8,oe),t[3]||(t[3]=e("div",{class:"video-overlay"},null,-1))]),t[9]||(t[9]=e("div",{class:"status-bar safe-area-top"},null,-1)),e("div",{class:"chat-content",ref_key:"chatContent",ref:_},[a.value.length===0?(r(),l("div",ae,[t[4]||(t[4]=e("div",{class:"logo-container"},[e("img",{src:X,alt:"LoneIN",class:"welcome-logo"})],-1)),t[5]||(t[5]=e("div",{class:"welcome-text"},[M("今天心情如何，"),e("br"),M(" 要把心事变成作品吗？")],-1)),e("div",{class:"start-chat-container"},[e("button",{class:"start-chat-btn",onClick:z}," 开始对话 ")])])):h("",!0),(r(!0),l(D,null,x(a.value,n=>(r(),l("div",{key:n.id,class:"message-item"},[e("div",{class:U(["message-bubble",n.role==="user"?"message-user":"message-ai"])},b(n.content),3),e("div",ne,b(j(n.created_at)),1)]))),128)),p.value?(r(),l("div",ie,[e("div",le,[t[6]||(t[6]=e("div",{class:"suggestion-text"},"要把这段心情留成一张诗卡/一幅画吗？",-1)),e("div",re,[e("button",{class:"btn-suggestion",onClick:t[0]||(t[0]=n=>f("poem"))},"诗卡"),e("button",{class:"btn-suggestion",onClick:t[1]||(t[1]=n=>f("image"))},"画作"),e("button",{class:"btn-dismiss",onClick:N},"稍后")])])])):h("",!0),k.value?(r(),l("div",ce,[...t[7]||(t[7]=[e("div",{class:"loading"},null,-1),e("span",null,"正在为你把这段心情化成作品…",-1)])])):h("",!0),s.value?(r(),l("div",ue,[e("div",{class:"work-card",onClick:B},[e("div",de,[e("h3",ve,b(s.value.title),1),e("div",ge,[(r(!0),l(D,null,x(s.value.emotion_labels,n=>(r(),l("span",{key:n,class:"tag"},b(n),1))),128))])]),e("div",me,[s.value.modality==="poem"?(r(),l("div",_e,b(s.value.desc),1)):s.value.modality==="image"?(r(),l("div",pe,[...t[8]||(t[8]=[e("div",{class:"image-placeholder"},"🎨 画作生成中...",-1)])])):h("",!0)]),e("div",he,[e("button",{class:"btn-action",onClick:y(L,["stop"])},"保存到我的"),e("button",{class:"btn-action",onClick:y(P,["stop"])},"分享"),e("button",{class:"btn-action",onClick:y(R,["stop"])},"换形态")])])])):h("",!0)],512),e("div",be,[e("div",ke,[e("button",{class:"voice-btn",onClick:V},[S(T(Y),{size:18})]),$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>c.value=n),type:"text",class:"message-input",placeholder:"说点什么...",onKeyup:G(v,["enter"])},null,544),[[A,c.value]]),e("button",{class:"send-btn",onClick:v,disabled:!c.value.trim()},[S(T(Z),{size:18})],8,fe)])]),S(J,{current:"chat"})]))}});const Ie=q(we,[["__scopeId","data-v-b0b39251"]]);export{Ie as default};
