import{d as E,r as i,a as F,o as K,c as l,b as e,e as M,f as h,F as D,g as x,t as b,w as y,h as S,u as T,i as $,v as A,j as G,k as H,n as C,l as r,m as U,_ as q}from"./index-f73cffae.js";import{T as J}from"./TabBar-2bde1b6e.js";import{g as Q}from"./api-d1d50a56.js";import{c as I}from"./createLucideIcon-8fa92933.js";import"./user-6c86de88.js";import"./message-circle-400a59da.js";import"./musicApi-3bd1a4e5.js";const X="/assets/logo-1dceb1f3.png";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=I("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=I("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ee=E("chat",()=>{const d=i(null),m=i([]),_=i(!1),g=i([]),c=()=>{const u={id:Date.now().toString(),user_id:"current-user",created_at:new Date().toISOString(),status:"active"};return d.value=u,u};return{currentSession:d,messages:m,isTyping:_,works:g,createSession:c,sendMessage:u=>{d.value||c();const v={id:Date.now().toString(),session_id:d.value.id,role:"user",content:u,created_at:new Date().toISOString()};return m.value.push(v),v},receiveMessage:u=>{if(!d.value)return{};const v={id:(Date.now()+1).toString(),session_id:d.value.id,role:"ai",content:u,created_at:new Date().toISOString()};return m.value.push(v),v},saveWork:u=>{g.value.push(u)},clearChat:()=>{m.value=[],d.value=null}}}),te={class:"chat-page"},se={class:"video-container"},oe=["src"],ae={key:0,class:"welcome-message"},ne={class:"message-time"},ie={key:1,class:"suggestion-bubble"},le={class:"suggestion-content"},re={class:"suggestion-actions"},ce={key:2,class:"generating-message"},ue={key:3,class:"work-card-container"},de={class:"work-header"},ve={class:"work-title"},ge={class:"work-tags"},me={class:"work-content"},_e={key:0,class:"poem-content"},pe={key:1,class:"image-content"},he={class:"work-actions"},be={class:"input-area safe-area-bottom"},ke={class:"input-container"},fe=["disabled"],we=F({__name:"ChatPage",setup(d){const m=H();ee();const _=i(),g=i(),c=i(""),a=i([]),p=i(!1),k=i(!1),s=i(null),u=i("/background.mp4"),v=async()=>{if(!c.value.trim())return;const o={id:Date.now().toString(),session_id:"current",role:"user",content:c.value,created_at:new Date().toISOString()};a.value.push(o),c.value,c.value="",await C(),w(),setTimeout(()=>{const t={id:(Date.now()+1).toString(),session_id:"current",role:"ai",content:O(),created_at:new Date().toISOString()};a.value.push(t),W()&&setTimeout(()=>{p.value=!0},1e3),C(()=>w())},1e3)},O=o=>{const t=["æˆ‘èƒ½æ„Ÿå—åˆ°ä½ çš„æƒ…ç»ªï¼Œèƒ½å†è¯¦ç»†è¯´è¯´è¿™ä»¶äº‹å¯¹ä½ çš„æ„ä¹‰å—ï¼Ÿ","è¿™å¬èµ·æ¥å¾ˆæœ‰ç”»é¢æ„Ÿï¼Œä½ å½“æ—¶çš„æ„Ÿå—æ˜¯æ€Žæ ·çš„ï¼Ÿ","æˆ‘ç†è§£ä½ çš„æ„Ÿå—ï¼Œè¿™ç§ç»åŽ†ä¸€å®šå¾ˆç‰¹åˆ«å§ï¼Ÿ","å¬èµ·æ¥è¿™å¯¹ä½ æ¥è¯´å¾ˆé‡è¦ï¼Œæƒ³è¦æŠŠè¿™ä»½å¿ƒæƒ…è®°å½•ä¸‹æ¥å—ï¼Ÿ"];return t[Math.floor(Math.random()*t.length)]},W=()=>a.value.length>=6&&Math.random()>.5,f=async o=>{p.value=!1,k.value=!0;try{if(o==="poem"){const t=await Q(a.value.map(n=>n.content).join(`
`),"æ·±æ€","äººç”Ÿæ„Ÿæ‚Ÿ");s.value={id:Date.now().toString(),user_id:"current-user",session_id:"current",source_message_id:a.value[a.value.length-1].id,modality:o,title:t.title,desc:t.content,emotion_labels:["æ·±æ€","æ„Ÿæ‚Ÿ","è¯—æ„"],visibility:"private",created_at:new Date().toISOString()}}else await new Promise(t=>setTimeout(t,2e3)),s.value={id:Date.now().toString(),user_id:"current-user",session_id:"current",source_message_id:a.value[a.value.length-1].id,modality:o,title:"æœˆä¸‹ç‹¬é…Œ",desc:"ä¸€å¹…æç»˜æœˆä¸‹ç‹¬è‡ªæ€è€ƒçš„ç”»ä½œ",emotion_labels:["å­¤ç‹¬","æ€å¿µ","æ·±å¤œ"],visibility:"private",created_at:new Date().toISOString()}}catch(t){console.error("ç”Ÿæˆå†…å®¹å¤±è´¥:",t),s.value={id:Date.now().toString(),user_id:"current-user",session_id:"current",source_message_id:a.value[a.value.length-1].id,modality:o,title:"ç”Ÿæˆå¤±è´¥",desc:"æŠ±æ­‰ï¼Œå†…å®¹ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•",emotion_labels:["ç³»ç»Ÿ"],visibility:"private",created_at:new Date().toISOString()}}finally{k.value=!1,C(()=>w())}},N=()=>{p.value=!1},V=()=>{console.log("è¯­éŸ³åŠŸèƒ½å¾…å®žçŽ°")},z=()=>{m.push("/conversation")},B=()=>{s.value&&console.log("æŸ¥çœ‹ä½œå“:",s.value)},L=()=>{s.value&&console.log("ä¿å­˜ä½œå“")},P=()=>{s.value&&console.log("åˆ†äº«ä½œå“")},R=()=>{if(s.value){const o=s.value.modality==="poem"?"image":"poem";f(o)}},j=o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),w=()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)};return K(()=>{console.log("èŠå¤©é¡µé¢å·²åŠ è½½"),g.value&&g.value.addEventListener("loadeddata",()=>{var o;console.log("è§†é¢‘åŠ è½½å®Œæˆ"),(o=g.value)==null||o.play().catch(t=>{console.log("è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:",t)})})}),(o,t)=>(r(),l("div",te,[e("div",se,[e("video",{class:"video-background",autoplay:"",muted:"",loop:"",playsinline:"",preload:"auto",ref_key:"videoRef",ref:g,src:u.value},null,8,oe),t[3]||(t[3]=e("div",{class:"video-overlay"},null,-1))]),t[9]||(t[9]=e("div",{class:"status-bar safe-area-top"},null,-1)),e("div",{class:"chat-content",ref_key:"chatContent",ref:_},[a.value.length===0?(r(),l("div",ae,[t[4]||(t[4]=e("div",{class:"logo-container"},[e("img",{src:X,alt:"LoneIN",class:"welcome-logo"})],-1)),t[5]||(t[5]=e("div",{class:"welcome-text"},[M("ä»Šå¤©å¿ƒæƒ…å¦‚ä½•ï¼Œ"),e("br"),M(" è¦æŠŠå¿ƒäº‹å˜æˆä½œå“å—ï¼Ÿ")],-1)),e("div",{class:"start-chat-container"},[e("button",{class:"start-chat-btn",onClick:z}," å¼€å§‹å¯¹è¯ ")])])):h("",!0),(r(!0),l(D,null,x(a.value,n=>(r(),l("div",{key:n.id,class:"message-item"},[e("div",{class:U(["message-bubble",n.role==="user"?"message-user":"message-ai"])},b(n.content),3),e("div",ne,b(j(n.created_at)),1)]))),128)),p.value?(r(),l("div",ie,[e("div",le,[t[6]||(t[6]=e("div",{class:"suggestion-text"},"è¦æŠŠè¿™æ®µå¿ƒæƒ…ç•™æˆä¸€å¼ è¯—å¡/ä¸€å¹…ç”»å—ï¼Ÿ",-1)),e("div",re,[e("button",{class:"btn-suggestion",onClick:t[0]||(t[0]=n=>f("poem"))},"è¯—å¡"),e("button",{class:"btn-suggestion",onClick:t[1]||(t[1]=n=>f("image"))},"ç”»ä½œ"),e("button",{class:"btn-dismiss",onClick:N},"ç¨åŽ")])])])):h("",!0),k.value?(r(),l("div",ce,[...t[7]||(t[7]=[e("div",{class:"loading"},null,-1),e("span",null,"æ­£åœ¨ä¸ºä½ æŠŠè¿™æ®µå¿ƒæƒ…åŒ–æˆä½œå“â€¦",-1)])])):h("",!0),s.value?(r(),l("div",ue,[e("div",{class:"work-card",onClick:B},[e("div",de,[e("h3",ve,b(s.value.title),1),e("div",ge,[(r(!0),l(D,null,x(s.value.emotion_labels,n=>(r(),l("span",{key:n,class:"tag"},b(n),1))),128))])]),e("div",me,[s.value.modality==="poem"?(r(),l("div",_e,b(s.value.desc),1)):s.value.modality==="image"?(r(),l("div",pe,[...t[8]||(t[8]=[e("div",{class:"image-placeholder"},"ðŸŽ¨ ç”»ä½œç”Ÿæˆä¸­...",-1)])])):h("",!0)]),e("div",he,[e("button",{class:"btn-action",onClick:y(L,["stop"])},"ä¿å­˜åˆ°æˆ‘çš„"),e("button",{class:"btn-action",onClick:y(P,["stop"])},"åˆ†äº«"),e("button",{class:"btn-action",onClick:y(R,["stop"])},"æ¢å½¢æ€")])])])):h("",!0)],512),e("div",be,[e("div",ke,[e("button",{class:"voice-btn",onClick:V},[S(T(Y),{size:18})]),$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>c.value=n),type:"text",class:"message-input",placeholder:"è¯´ç‚¹ä»€ä¹ˆ...",onKeyup:G(v,["enter"])},null,544),[[A,c.value]]),e("button",{class:"send-btn",onClick:v,disabled:!c.value.trim()},[S(T(Z),{size:18})],8,fe)])]),S(J,{current:"chat"})]))}});const Ie=q(we,[["__scopeId","data-v-b0b39251"]]);export{Ie as default};
